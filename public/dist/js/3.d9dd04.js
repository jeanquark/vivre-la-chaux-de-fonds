(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{12:function(e,t,n){"use strict";var o=n(34),s=n(35),i=n(36),r=n(37),a={components:{ImagesModal:o.a,DocumentsModal:s.a,CreateLinkModal:i.a,ImageProperties:r.a},props:["formContent"],created:function(){},mounted:function(){this.content=this.formContent},data:function(){return{content:"",showHTML:!1,checked:!1,showImagesModal:!1,showDocumentsModal:!1,showCreateLinkModal:!1,selectedImageNode:null,selectedImageProps:{width:0,height:0,style:{}},selectedText:"",focused:!1,selRange:null}},computed:{},methods:{toggleShowHTML:function(){this.showHTML?this.content=document.getElementById("textBox").innerText:this.content=document.getElementById("textBox").innerHTML,this.showHTML=!this.showHTML,this.$emit("toggleShowHTML",this.showHTML)},selectElement:function(e){this.selectedImageNode=null,console.log("selectElement: ",e);var t=e.target.tagName.toLowerCase();console.log("element: ",t),"img"===t&&(console.log("img!"),this.selectedImageNode=e.target,this.selectedImageProps.width=e.target.width,this.selectedImageProps.height=e.target.height,this.selectedImageProps.style["margin-left"]=e.target.style["margin-left"]?e.target.style["margin-left"].match(/\d/g).join(""):0,this.selectedImageProps.style["margin-right"]=e.target.style["margin-right"]?e.target.style["margin-right"].match(/\d/g).join(""):0,this.selectedImageProps.style.float=e.target.style.float)},updateSelectedImageProperties:function(e,t){console.log("updateSelectedImageProperties2: ",e,t),console.log("selectedImageNode: ",this.selectedImageNode),"width"!==t&&"height"!==t||(this.selectedImageNode[t]=e),"marginLeft"===t&&(this.selectedImageNode.style.marginLeft="".concat(e,"px")),"marginRight"===t&&(this.selectedImageNode.style.marginRight="".concat(e,"px")),"float"===t&&(this.selectedImageNode.style.float=e)},openImagesModal:function(){var e=this;console.log("openImagesModal"),this.showImagesModal=!0,setTimeout(function(){e.$bvModal.show("imagesModal")},300)},openDocumentsModal:function(){var e=this;console.log("openDocumentsModal"),this.showDocumentsModal=!0,setTimeout(function(){e.$bvModal.show("documentsModal")},300)},openCreateLinkModal:function(){var e=this;console.log("openCreateLinkModal"),this.selectedText=window.getSelection().toString()||"Lien",this.selRange=this.saveSelection(),this.showCreateLinkModal=!0,setTimeout(function(){e.$bvModal.show("createLinkModal")},300)},insertImage:function(e){console.log("insertImage2: ",e),this.showModal=!1;var t="/images/".concat(e);this.formatDoc("insertImage",t)},insertDocument:function(e,t,n){console.log("insertDocument",e,t,n),this.formatDoc("insertHTML",'<a href="/documents/'.concat(e,'" type="').concat(t,'" title="').concat(n,'" target="_blank">').concat(n,"</a>"))},insertLink:function(e){var t,n=e.linkType,o=e.linkPage;console.log("insertLink",n,o),t="external"===n?'<a href="'.concat(o.external,'">').concat(this.selectedText,"</a>"):'<router-link to="/'.concat(o.internal.slug,'"><span class="link">').concat(this.selectedText,"</span></router-link>"),this.restoreSelection(this.selRange),document.getElementById("textBox").focus(),this.insertTextAtCursor(t)},formatDoc:function(e,t){document.execCommand(e,!1,t)},saveSelection:function(){var e;if(window.getSelection){if((e=window.getSelection()).getRangeAt&&e.rangeCount)return e.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},restoreSelection:function(e){var t;e&&(window.getSelection?((t=window.getSelection()).removeAllRanges(),t.addRange(e)):document.selection&&e.select&&e.select())},insertTextAtCursor:function(e){var t,n;if(window.getSelection){if((t=window.getSelection()).getRangeAt&&t.rangeCount){(n=t.getRangeAt(0)).deleteContents();var o=document.createElement("div");o.innerHTML=e;for(var s,i,r=document.createDocumentFragment();s=o.firstChild;)i=r.appendChild(s);n.insertNode(r),i&&((n=n.cloneRange()).setStartAfter(i),n.collapse(!0),t.removeAllRanges(),t.addRange(n))}}else document.selection&&document.selection.createRange&&((n=document.selection.createRange()).pasteHTML(e),n.select())}}},c=(n(273),n(2)),l=Object(c.a)(a,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("b-form-group",{attrs:{label:""}},[n("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"mx-.5",attrs:{variant:"primary",title:"Gras"},on:{click:function(t){return t.preventDefault(),e.formatDoc("bold")}}},[n("font-awesome-icon",{attrs:{size:"1x",icon:"bold"}})],1),e._v(" "),n("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"mx-.5",attrs:{variant:"primary",title:"Italic"},on:{click:function(t){return t.preventDefault(),e.formatDoc("italic")}}},[n("font-awesome-icon",{attrs:{size:"1x",icon:"italic"}})],1),e._v(" "),n("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"mx-.5",attrs:{variant:"primary",title:"Souligné"},on:{click:function(t){return t.preventDefault(),e.formatDoc("underline")}}},[n("font-awesome-icon",{attrs:{size:"1x",icon:"underline"}})],1),e._v(" "),n("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"mx-.5",attrs:{variant:"primary",title:"Aligner à gauche"},on:{click:function(t){return t.preventDefault(),e.formatDoc("justifyleft")}}},[n("font-awesome-icon",{attrs:{size:"1x",icon:"align-left"}})],1),e._v(" "),n("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"mx-.5",attrs:{variant:"primary",title:"Aligner au centre"},on:{click:function(t){return t.preventDefault(),e.formatDoc("justifycenter")}}},[n("font-awesome-icon",{attrs:{size:"1x",icon:"align-center"}})],1),e._v(" "),n("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"mx-.5",attrs:{variant:"primary",title:"Aligner à droite"},on:{click:function(t){return t.preventDefault(),e.formatDoc("justifyright")}}},[n("font-awesome-icon",{attrs:{size:"1x",icon:"align-right"}})],1),e._v(" "),n("b-button",{staticClass:"mx-.5",attrs:{variant:"primary",title:"Liste point"},on:{click:function(t){return t.preventDefault(),e.formatDoc("insertUnorderedList")}}},[n("font-awesome-icon",{attrs:{size:"1x",icon:"list-ul"}})],1),e._v(" "),n("b-button",{staticClass:"mx-.5",attrs:{variant:"primary",title:"Liste nombre"},on:{click:function(t){return t.preventDefault(),e.formatDoc("insertOrderedList")}}},[n("font-awesome-icon",{attrs:{size:"1x",icon:"list-ol"}})],1),e._v(" "),n("b-button",{staticClass:"mx-.5",attrs:{variant:"primary",title:"Lien"},on:{click:function(t){return t.preventDefault(),e.openCreateLinkModal(t)}}},[n("font-awesome-icon",{attrs:{size:"1x",icon:"link"}})],1),e._v(" "),n("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"mx-.5",attrs:{variant:"secondary",title:"Ajouter image",disabled:!e.focused},on:{mousedown:function(t){t.preventDefault(),e.focused=!0},click:function(t){return t.preventDefault(),e.openImagesModal(t)}}},[n("font-awesome-icon",{attrs:{size:"1x",icon:"image"}})],1),e._v(" "),n("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"mx-.5",attrs:{variant:"secondary",title:"Ajouter PDF",disabled:!e.focused},on:{mousedown:function(t){t.preventDefault(),e.focused=!0},click:function(t){return t.preventDefault(),e.openDocumentsModal(t)}}},[n("font-awesome-icon",{attrs:{size:"1x",icon:"file-pdf"}})],1),e._v(" "),n("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"mx-.5",attrs:{variant:"dark",title:"Afficher le code/afficher le rendu"},on:{click:e.toggleShowHTML}},[e.showHTML?n("font-awesome-icon",{attrs:{size:"1x",icon:["fa","eye"]}}):n("font-awesome-icon",{attrs:{size:"1x",icon:"code"}})],1),e._v(" "),e.selectedImageNode?n("b-row",{staticClass:"justify-content-center my-2",attrs:{"no-gutters":""}},[n("b-col",{attrs:{cols:"12"}},[n("image-properties",{attrs:{selectedImageProps:e.selectedImageProps},on:{updateSelectedImageProperties:e.updateSelectedImageProperties}})],1)],1):e._e(),e._v(" "),e.showHTML?n("div",{staticClass:"mt-1",attrs:{contenteditable:"true",id:"textBox"},on:{focus:function(t){e.focused=!0},blur:function(t){e.focused=!1}}},[n("pre",{},[e._v(e._s(e.content))])]):n("div",{staticClass:"mt-1",attrs:{contenteditable:"true",id:"textBox"},domProps:{innerHTML:e._s(e.content)},on:{focus:function(t){e.focused=!0},blur:function(t){e.focused=!1},click:e.selectElement}})],1),e._v(" "),e.showImagesModal?n("images-modal",{on:{insertImage:e.insertImage,closeImagesModal:function(t){e.showImagesModal=!1}}}):e._e(),e._v(" "),e.showDocumentsModal?n("documents-modal",{on:{insertDocument:e.insertDocument,closeDocumentsModal:function(t){e.showDocumentsModal=!1}}}):e._e(),e._v(" "),e.showCreateLinkModal?n("create-link-modal",{attrs:{selectedText:e.selectedText},on:{insertLink:e.insertLink,closeLinkModal:function(t){e.showCreateLinkModal=!1}}}):e._e()],1)},[],!1,null,"78b862e4",null);t.a=l.exports},21:function(e,t,n){"use strict";n.r(t);var o=n(0),s=n.n(o);n(3);function i(e,t,n,o,s,i,r){try{var a=e[i](r),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(o,s)}function r(e){return function(){var t=this,n=arguments;return new Promise(function(o,s){var r=e.apply(t,n);function a(e){i(r,o,s,a,c,"next",e)}function c(e){i(r,o,s,a,c,"throw",e)}a(void 0)})}}var a={components:{TextEditor:n(12).a},layout:"backend",created:function(){var e=r(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.$store.commit("loading/SET_LOADING",!0),e.next=4,this.$store.dispatch("newsletters/fetchNewsletters");case 4:this.$store.commit("loading/SET_LOADING",!1),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.log("error: ",e.t0),this.$store.commit("loading/SET_LOADING",!1);case 11:case"end":return e.stop()}},e,this,[[0,7]])}));return function(){return e.apply(this,arguments)}}(),data:function(){return{sortBy:"id",sortDesc:!0,fields:[{key:"id",label:"ID",sortable:!0},{key:"selected",label:"",sortable:!0},{key:"email",label:"E-mail",sortable:!0},{key:"emails_sent",label:"Nb. d'envois",sortable:!0},{key:"updated_at",label:"Dernière modification",sortable:!0},{key:"actions",sortable:!1}],selected:[],showHTML:!1,emailsList:""}},computed:{loading:function(){return this.$store.getters["loading/loading"]},newsletters:function(){return Object.values(this.$store.getters["newsletters/newsletters"])},selectedSubscribers:function(){return this.selected.map(function(e){return{id:e.id,email:e.email}})}},methods:{onRowSelected:function(e){this.selected=e},selectAllRows:function(){this.$refs.selectableTable.selectAllRows()},clearSelected:function(){this.$refs.selectableTable.clearSelected()},toggleShowHTML:function(e){console.log("toggleShowHTML: ",e),this.showHTML=e},generateEmailsList:function(){this.emailsList=this.newsletters.map(function(e){return e.email})},sendNewsletter:function(){var e=r(s.a.mark(function e(){var t;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("selectedSubscribers: ",this.selectedSubscribers),console.log("selected: ",this.selected),t=this.showHTML?document.getElementById("textBox").innerText:document.getElementById("textBox").innerHTML,e.next=6,this.$store.dispatch("newsletters/sendNewsletter",{subscribers:this.selectedSubscribers,newsletter:t});case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log("error: ",e.t0);case 11:case"end":return e.stop()}},e,this,[[0,8]])}));return function(){return e.apply(this,arguments)}}(),deleteSubscription:function(){var e=r(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$bvModal.msgBoxConfirm("Etes-vous sûr de vouloir supprimer l'inscription ".concat(t,"?"),{okTitle:"Oui",cancelTitle:"Annuler"});case 3:if(n=e.sent,console.log("value: ",n),!n){e.next=9;break}return e.next=8,this.$store.dispatch("newsletters/deleteSubscription",{newsletterId:t});case 8:this.$noty.success("Inscription supprimée avec succès!");case 9:e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),console.log("error: ",e.t0),this.$noty.error("Une erreur est survenue et l'inscription n'a pas pu être supprimée.");case 15:case"end":return e.stop()}},e,this,[[0,11]])}));return function(t){return e.apply(this,arguments)}}()}},c=n(2),l=Object(c.a)(a,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-container",[n("b-breadcrumb",[n("b-breadcrumb-item",{attrs:{active:""}},[n("font-awesome-icon",{attrs:{icon:"envelope"}}),e._v(" Newsletters\r\n        ")],1)],1),e._v(" "),n("h2",{staticClass:"text-center"},[e._v("Abonnés")]),e._v(" "),n("br"),e._v(" "),n("b-table",{ref:"selectableTable",attrs:{selectable:"","select-mode":"multi",items:e.newsletters,fields:e.fields,responsive:"sm","sort-by":e.sortBy,"sort-desc":e.sortDesc},on:{"update:sortBy":function(t){e.sortBy=t},"update:sort-by":function(t){e.sortBy=t},"update:sortDesc":function(t){e.sortDesc=t},"update:sort-desc":function(t){e.sortDesc=t},"row-selected":e.onRowSelected},scopedSlots:e._u([{key:"cell(selected)",fn:function(t){return[t.rowSelected?[n("span",{attrs:{"aria-hidden":"true"}},[e._v("✓")]),e._v(" "),n("span",{staticClass:"sr-only"},[e._v("Selected")])]:[n("span",{attrs:{"aria-hidden":"true"}},[e._v(" ")]),e._v(" "),n("span",{staticClass:"sr-only"},[e._v("Not selected")])]]}},{key:"cell(updated_at)",fn:function(t){return[e._v("\r\n            "+e._s(e._f("moment")(t.item.updated_at,"from","now"))+"\r\n        ")]}},{key:"cell(actions)",fn:function(t){return[n("b-button",{staticClass:"my-1",attrs:{variant:"danger"},on:{click:function(n){return e.deleteSubscription(t.item.id)}}},[n("font-awesome-icon",{attrs:{icon:"trash"}})],1)]}}])}),e._v(" "),n("p",[n("b-button",{attrs:{variant:"primary",size:"sm"},on:{click:e.selectAllRows}},[e._v("Tout sélectionner")]),e._v(" "),n("b-button",{attrs:{variant:"secondary",size:"sm"},on:{click:e.clearSelected}},[e._v("Tout désélectionner")]),e._v(" "),n("b-button",{attrs:{variant:"dark",size:"sm"},on:{click:e.generateEmailsList}},[e._v("Générer liste d'emails")])],1),e._v(" "),e.emailsList?n("div",[e._v("\r\n        Liste d'emails: "+e._s(e.emailsList)+"\r\n    ")]):e._e(),e._v(" "),n("div",{staticStyle:{display:"none"}},[n("br"),n("br"),e._v(" "),n("h3",{staticClass:"text-center mb-3"},[e._v("Rédiger une newsletter:")]),e._v(" "),n("text-editor",{on:{toggleShowHTML:e.toggleShowHTML}})],1),e._v(" "),n("p",{staticClass:"text-center",staticStyle:{display:"none"}},[n("b-button",{attrs:{variant:"success",size:"sm"},on:{click:e.sendNewsletter}},[e._v("Envoyer la newsletter")])],1)],1)},[],!1,null,"f9c816e8",null);t.default=l.exports},273:function(e,t,n){"use strict";var o=n(33);n.n(o).a},274:function(e,t,n){(e.exports=n(6)(!1)).push([e.i,"#textBox[data-v-78b862e4] {\n  width: 100%;\n  height: 300px;\n  border: 6px double #E1B124;\n  padding: 12px;\n  overflow: scroll;\n}\n#textBox #sourceText[data-v-78b862e4] {\n  padding: 0;\n  margin: 0;\n  min-width: 498px;\n  min-height: 200px;\n}\n.overlay[data-v-78b862e4] {\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  height: 100%;\n  width: 100%;\n  opacity: 0;\n  transition: 0.5s ease;\n  background-color: #008cba;\n}\n[data-v-78b862e4] #textBox img:hover {\n  cursor: pointer;\n  opacity: 0.5;\n  transition: 0.5s ease;\n  background-color: #2C5CAD;\n}\n[data-v-78b862e4] #textBox .link {\n  color: #2c5cad;\n}\n[data-v-78b862e4] #textBox .link:hover {\n  color: #1c3c70;\n  text-decoration: underline;\n}\n#editMode label[data-v-78b862e4] {\n  cursor: pointer;\n}\n.intLink[data-v-78b862e4] {\n  cursor: pointer;\n}\nimg.intLink[data-v-78b862e4] {\n  border: 1px solid #000;\n}\n.disabled[data-v-78b862e4]:hover {\n  cursor: not-allowed;\n  color: #000;\n}\npre[data-v-78b862e4] {\n  overflow-x: auto;\n  white-space: pre-wrap;\n  white-space: -moz-pre-wrap;\n  white-space: -pre-wrap;\n  white-space: -o-pre-wrap;\n  word-wrap: break-word;\n}",""])},33:function(e,t,n){var o=n(274);"string"==typeof o&&(o=[[e.i,o,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};n(7)(o,s);o.locals&&(e.exports=o.locals)}}]);